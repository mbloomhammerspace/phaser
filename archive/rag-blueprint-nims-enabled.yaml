# NVIDIA RAG Blueprint - Enable NIMs with Working NGC Key

# Update NGC API Key to working key from build.nvidia.com
ngcApiSecret:
  create: true
  name: ngc-api
  password: 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

imagePullSecret:
  create: true
  name: ngc-secret
  password: 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

# Enable NIM LLM
nim-llm:
  enabled: true
  image:
    repository: nvcr.io/nim/meta/llama3-8b-instruct
    tag: latest
    pullPolicy: IfNotPresent
  model:
    ngcAPIKey: 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
    nimCachePath: /model-store
  replicaCount: 1
  resources:
    limits:
      nvidia.com/gpu: 1
      memory: 32Gi
      cpu: 8
    requests:
      nvidia.com/gpu: 1
      memory: 16Gi
      cpu: 4
  service:
    type: ClusterIP
    port: 8000
  persistence:
    enabled: true
    storageClass: nfs-csi
    size: 50Gi
  tolerations:
  - key: nvidia.com/gpu
    operator: Exists
    effect: NoSchedule
  nodeSelector:
    kubernetes.io/hostname: instance-20251003-1851

# Enable NIM Embedding
nvidia-nim-llama-32-nv-embedqa-1b-v2:
  enabled: true
  image:
    repository: nvcr.io/nim/nvidia/llama-3.2-nv-embedqa-1b-v2
    tag: 1.2.2
    pullPolicy: IfNotPresent
  model:
    ngcAPIKey: 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
    nimCachePath: /model-store
  replicaCount: 1
  resources:
    limits:
      nvidia.com/gpu: 1
      memory: 16Gi
      cpu: 4
    requests:
      nvidia.com/gpu: 1
      memory: 8Gi
      cpu: 2
  service:
    type: ClusterIP
    port: 8000
  persistence:
    enabled: true
    storageClass: nfs-csi
    size: 30Gi
  tolerations:
  - key: nvidia.com/gpu
    operator: Exists
    effect: NoSchedule
  nodeSelector:
    kubernetes.io/hostname: instance-20251003-1851

# Enable Text Reranking NIM
text-reranking-nim:
  enabled: true
  image:
    repository: nvcr.io/nim/nvidia/llama-3.2-nv-rerankqa-1b-v2
    tag: 1.2.2
    pullPolicy: IfNotPresent
  model:
    ngcAPIKey: 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
    nimCachePath: /model-store
  replicaCount: 1
  resources:
    limits:
      nvidia.com/gpu: 1
      memory: 16Gi
      cpu: 4
    requests:
      nvidia.com/gpu: 1
      memory: 8Gi
      cpu: 2
  service:
    type: ClusterIP
    port: 8000
  persistence:
    enabled: true
    storageClass: nfs-csi
    size: 30Gi
  tolerations:
  - key: nvidia.com/gpu
    operator: Exists
    effect: NoSchedule
  nodeSelector:
    kubernetes.io/hostname: instance-20251003-1851

# Update environment variables with new NGC key
envVars:
  NGC_API_KEY: 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
  NVIDIA_API_KEY: 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
  APP_LLM_MODELNAME: nvidia/llama-3.3-nemotron-super-49b-v1
  APP_LLM_SERVERURL: http://nim-llm:8000/v1
  APP_EMBEDDINGS_MODELNAME: nvidia/llama-3.2-nv-embedqa-1b-v2
  APP_EMBEDDINGS_SERVERURL: http://nvidia-nim-llama-32-nv-embedqa-1b-v2:8000/v1
  APP_RANKING_MODELNAME: nvidia/llama-3.2-nv-rerankqa-1b-v2
  APP_RANKING_SERVERURL: http://text-reranking-nim:8000/v1
  APP_VECTORSTORE_NAME: milvus
  APP_VECTORSTORE_URL: http://milvus:19530
  COLLECTION_NAME: pdfs_new_ingestion
  ENABLE_CITATIONS: "True"
  ENABLE_RERANKER: "True"
  LOGLEVEL: INFO

# Keep frontend and other services enabled
frontend:
  enabled: true
  replicaCount: 1

ingestor-server:
  enabled: true
  replicaCount: 1

# Enable Zipkin for tracing
zipkin:
  enabled: true
  service:
    type: NodePort
    nodePort: 30669

# Enable OpenTelemetry
opentelemetry-collector:
  enabled: true
